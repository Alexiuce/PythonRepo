{"version":3,"sources":["menu.js"],"names":["layui","define","exports","_","this","axios","storage","Menu","undefined","dynamicRender","elem","onClicked","data","url","method","isJump","cached","$","jquery","utils","lodash","MENU","MENU_ITEM","THIS","set","options","extend","config","prototype","render","that","length","setItem","cacheKey","_private","renderHTML","bind","isHandled","getItem","loadData","remote","each","className","_item","_a","isOneLevel","find","addClass","hasChild","attr","layid","randomCode","e","hasClass","siblings","removeClass","off","on","stope","isFunction","location","hash","router","href","split","_active","parents","removeCache","key","removeItem","callback","temps","recursion","_elem","push","error","join","temp","datas","pid","curr","item","index","forEach","open","path","blank","icon","title","children","res","status","Error","statusText","catch"],"mappings":"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","file":"menu.js","sourcesContent":["layui.define(['jquery', 'utils', 'axios'], function(exports) { //提示：模块也可以依赖其它模块，如：layui.define('layer', callback);\r\n  var $ = layui.jquery,\r\n    utils = layui.utils,\r\n    _ = layui.lodash,\r\n    axios = layui.axios,\r\n    storage = utils.localStorage;\r\n  var Menu = function() {\r\n    this.config = {\r\n      elem: undefined, // 容器\r\n      onClicked: undefined, // 点击后触发的回调\r\n      dynamicRender: false, // 是否动态渲染 --如果此参数为true,则需要设置elem,[data或者remote]参数\r\n      data: [], // 数据\r\n      remote: { //此配置请参数axios的request配置，文档地址：https://www.kancloud.cn/yunye/axios/234845\r\n        url: undefined,\r\n        method: 'get'\r\n      },\r\n      cached: false, // 是否开启缓存,注：只缓存远程加载的数据。\r\n      cacheKey: 'KITADMINMENU', // 缓存key\r\n      isJump: true, //是否直接跳转页面\r\n      onlyOne: true\r\n    };\r\n    this.version = '1.0.2';\r\n  }\r\n  var MENU = '.kit-menu',\r\n    MENU_ITEM = '.kit-menu-item',\r\n    MENU_CHILD = '.kit-menu-child',\r\n    THIS = '.layui-this',\r\n    SHOW = '.layui-show';\r\n  // 设置参数\r\n  Menu.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  // 渲染\r\n  Menu.prototype.render = function() {\r\n    var that = this,\r\n      config = that.config;\r\n    // 是否需要动态渲染\r\n    if (config.dynamicRender) {\r\n      //本地数据优先级最高\r\n      if (config.data.length > 0) {\r\n        // 缓存数据\r\n        storage.setItem(config.cacheKey, data);\r\n        // 渲染DOM\r\n        _private.renderHTML(config.elem, config.data, function() {\r\n          // 绑定事件\r\n          that.bind();\r\n        });\r\n      } else {\r\n        //是否已经处理\r\n        var isHandled = false;\r\n        if (config.cached) {\r\n          var data = storage.getItem(config.cacheKey);\r\n          if (data !== null && data !== undefined) {\r\n            isHandled = true;\r\n            _private.renderHTML(config.elem, data, function() {\r\n              that.bind();\r\n            });\r\n          }\r\n        }\r\n        if (!isHandled) {\r\n          // 远程读取\r\n          _private.loadData(config.remote, function(data) {\r\n            // 缓存数据\r\n            storage.setItem(config.cacheKey, data);\r\n            // 渲染DOM\r\n            _private.renderHTML(config.elem, data, function() {\r\n              that.bind();\r\n            });\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      //绑定事件\r\n      that.bind();\r\n    }\r\n    return that;\r\n  };\r\n  // 绑定事件\r\n  Menu.prototype.bind = function() {\r\n    var that = this,\r\n      config = that.config;\r\n    $(MENU).find(MENU_ITEM).each(function() {\r\n      var _item = $(this);\r\n      var _a = _item.children('a');\r\n      var isOneLevel = _item.parent()[0].className === 'kit-menu';\r\n      if (isOneLevel) {\r\n        _item.attr('lay-one', true);\r\n      }\r\n      var hasChild = _item.find('ul.kit-menu-child').length > 0;\r\n      if (hasChild) {\r\n        _a.addClass('child');\r\n      }\r\n      var layid = _item.attr('lay-id');\r\n      if (layid === '' || layid === undefined) {\r\n        layid = utils.randomCode();\r\n        _item.attr('lay-id', layid);\r\n      }\r\n      _a.off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        if (!hasChild) {\r\n          $(MENU).find(MENU_ITEM).removeClass('layui-this');\r\n          _item.addClass('layui-this');\r\n        } else {\r\n          if (_item.hasClass('layui-show')) {\r\n            _item.removeClass('layui-show');\r\n          } else {\r\n            _item.addClass('layui-show');\r\n          }\r\n          // 只展开一个\r\n          if (config.onlyOne) {\r\n            if (_item.attr('lay-one')) {\r\n              _item.siblings().removeClass('layui-show');\r\n            }\r\n          }\r\n        }\r\n        utils.isFunction(config.onClicked) && config.onClicked({\r\n          elem: _item,\r\n          hasChild: hasChild,\r\n          data: {\r\n            href: _a.attr('href'),\r\n            layid: layid\r\n          }\r\n        });\r\n        // 拦截a标签的跳转\r\n        if (!config.isJump) {\r\n          return false;\r\n        }\r\n      });\r\n    });\r\n    if (location.hash !== undefined && location.hash !== '' && location.hash !== null) {\r\n      // 默认选中\r\n      var hash = '#' + layui.router(location.hash).href.split('?')[0];\r\n      var _active = $(MENU).find('a[href=\"' + hash + '\"]');\r\n      if (_active.length > 0) {\r\n        _active.parents('li').each(function() {\r\n          var _that = $(this);\r\n          if (!_that.hasClass('layui-show')) {\r\n            _that.children('a').click();\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return that;\r\n  };\r\n  // 移除缓存\r\n  Menu.prototype.removeCache = function(key) {\r\n    var that = this,\r\n      config = that.config;\r\n    key = key || config.cacheKey;\r\n    utils.localStorage.removeItem(key);\r\n  };\r\n\r\n  // 私有方法\r\n  var _private = {\r\n    // 渲染HTML\r\n    renderHTML: function(elem, data, callback) {\r\n      var that = this;\r\n      var temps = ['<ul class=\"kit-menu\">'];\r\n\r\n      var pid = 0; //一级菜单pid为0 ，这是一个约定\r\n      that.recursion(temps, data, pid);\r\n      if (temps.length > 0) {\r\n        // 闭合ul\r\n        temps.push('</ul>');\r\n        var _elem = $(elem);\r\n        if (_elem.length === 0) {\r\n          utils.error('Menu config error:请配置elem参数.');\r\n          return;\r\n        }\r\n        _elem.html(temps.join(''));\r\n        utils.isFunction(callback) && callback();\r\n      }\r\n    },\r\n    // 递归组装dom\r\n    recursion: function(temp, datas, pid) {\r\n      var that = this;\r\n      var curr = [];\r\n      _.forEach(datas, function(item, index) {\r\n        if (item.pid === pid)\r\n          curr.push(item);\r\n      });\r\n      if (curr.length > 0) {\r\n        _.forEach(curr, function(item) {\r\n          var open = item.open ? 'layui-show' : '';\r\n          temp.push('<li class=\"kit-menu-item ' + open + '\">');\r\n          var href = _.isEmpty(item.path) ? 'javascript:;' : item.path;\r\n          if (item.blank) {\r\n            temp.push('<a href=\"' + href + '\" target=\"_blank\">');\r\n          } else {\r\n            temp.push('<a href=\"' + href + '\">');\r\n          }\r\n          temp.push('<i class=\"layui-icon\">' + item.icon + '</i> ');\r\n          temp.push('<span>' + item.title + '</span>');\r\n          temp.push('</a>');\r\n          var children = item.children;\r\n          if (children !== undefined && children !== null && children.length > 0) {\r\n            temp.push('<ul class=\"kit-menu-child kit-menu-child layui-anim layui-anim-upbit\">');\r\n            that.recursion(temp, children, item.id);\r\n            temp.push('</ul>');\r\n          }\r\n          temp.push('</li>');\r\n        });\r\n      }\r\n    },\r\n    // 远程加载数据\r\n    loadData: function(options, callback) {\r\n      axios(options)\r\n        .then(function(res) {\r\n          if (res.status === 500)\r\n            throw new Error(res.statusText);\r\n          return res.data;\r\n        })\r\n        .then(function(data) {\r\n          callback(data);\r\n        })\r\n        .catch(function(error) {\r\n          utils.error(error);\r\n        });\r\n    }\r\n  };\r\n\r\n  var menu = new Menu();\r\n\r\n  //输出menu接口\r\n  exports('menu', menu);\r\n});"]}
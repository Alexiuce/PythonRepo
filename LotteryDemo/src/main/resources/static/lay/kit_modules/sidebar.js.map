{"version":3,"sources":["sidebar.js"],"names":["layui","define","exports","jquery","$","this","layer","laytpl","_","lodash","utils","Sidebar","elem","content","shade","shadeClose","title","direction","dynamicRender","url","width","done","join","defaults","that","id","config","undefined","options","tplLoader","_private","renderHTML","data","extend","errMsg","oneOf","error","_elem","render","Date","getTime","html","_body","_shade","eq","attr","toggle","hide","_sidebar","animate","show","close","click","on","_defineProperty","find","_that","parent","_typeof","showLoading","hideLoading","setTimeout","next","addClass","_load","remove","sidebar","append","load_tpl"],"mappings":"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","file":"sidebar.js","sourcesContent":["layui.define(['layer', 'laytpl', 'utils', 'lodash'], function(exports) {\r\n  const $ = layui.jquery,\r\n    layer = layui.layer,\r\n    laytpl = layui.laytpl,\r\n    _ = layui.lodash,\r\n    utils = layui.utils,\r\n    _body = $('body');\r\n  const Sidebar = function() {\r\n    this.version = '1.0.0';\r\n  };\r\n  const tpl = [\r\n    '<div class=\"kit-sidebar\" style=\"{{d.direction}}:-{{d.width}};width:{{d.width}};\" kit-sidebar=\"{{d.id}}\">',\r\n    '<div class=\"kit-sidebar-body\">',\r\n    '  <div class=\"layui-card\">',\r\n    '    <div class=\"layui-card-header\">',\r\n    '      <span class=\"nowrap\" title=\"{{d.title}}\">{{d.title}}</span>',\r\n    '      <div class=\"kit-sidebar-reload\" title=\"刷新\">',\r\n    '        <i class=\"layui-icon\">&#xe669;</i>',\r\n    '      </div>',\r\n    '      <div class=\"kit-sidebar-close\" title=\"关闭\">',\r\n    '        <i class=\"layui-icon\">&#x1006;</i>',\r\n    '      </div>',\r\n    '    </div>',\r\n    '    <div class=\"layui-card-body\">',\r\n    '      {{d.content}}',\r\n    '    </div>',\r\n    '  </div>',\r\n    '</div>',\r\n    '</div>'\r\n  ].join('');\r\n  const load_tpl = [\r\n    '<div class=\"kit-sidebar-loading layui-anim layui-anim-fadein\">',\r\n    '    <div>',\r\n    '        <i class=\"layui-icon layui-anim layui-anim-rotate layui-anim-loop\">&#xe63e;</i>',\r\n    '    </div>',\r\n    '</div>'\r\n  ];\r\n  Sidebar.prototype.defaults = {\r\n    elem: undefined, // 触发按钮\r\n    content: '', // 内容\r\n    shade: false, //显示遮盖层\r\n    shadeClose: true, // 点击遮盖层关闭\r\n    title: '未命名', //标题\r\n    direction: 'right', //方向  支持left or right \r\n    dynamicRender: false, //是否动态渲染\r\n    url: undefined, //远程地址\r\n    width: '280px', //盒子的宽度\r\n    done: undefined\r\n  };\r\n  Sidebar.prototype.render = function(options) {\r\n    const that = this;\r\n    // 克隆默认配置 -- 为了默认配置的干净\r\n    let defaults = _.cloneDeep(that.defaults);\r\n    $.extend(true, defaults, options);\r\n    const config = defaults;\r\n    // validate\r\n    if (!utils.oneOf(config.direction, ['left', 'right'])) {\r\n      utils.error('Sidebar error: [direction] property error,Only \"left\" or \"right\" .');\r\n      return that;\r\n    }\r\n    const data = {\r\n      title: config.title,\r\n      id: utils.randomCode(),\r\n      content: config.content,\r\n      direction: config.direction,\r\n      width: config.width\r\n    };\r\n    if (config.dynamicRender) {\r\n      const url = config.url + '?version=' + new Date().getTime();\r\n      utils.tplLoader(url, function(content) {\r\n        data.content = content;\r\n        _private.renderHTML(config, data);\r\n      }, function(errMsg) {\r\n        data.content = errMsg;\r\n        _private.renderHTML(config, data);\r\n      });\r\n    } else {\r\n      _private.renderHTML(config, data);\r\n    }\r\n    return that;\r\n  };\r\n  const _private = {\r\n    renderHTML: function(config, data) {\r\n      const _elem = $(config.elem);\r\n      if (_elem.attr('kit-sidebar-target') !== undefined) {\r\n        return;\r\n      }\r\n      laytpl(tpl).render(data, function(html) {\r\n        // 添加遮盖层\r\n        if (config.shade) {\r\n          html = html + '<div class=\"kit-shade\" kit-shade=\"' + data.id + '\"></div>';\r\n        }\r\n        _body.append(html);\r\n        // 处理事件\r\n        const _sidebar = $('div[kit-sidebar=\"' + data.id + '\"]');\r\n        _sidebar.attr('data-toggle', 'off');\r\n        const _shade = $('div[kit-shade=\"' + data.id + '\"]');\r\n        typeof config.done === 'function' && config.done({\r\n          config: config,\r\n          close: function() {\r\n            _elem.eq(0).click();\r\n          }\r\n        });\r\n        // _elem.attr('data-toggle', 'off');\r\n        // _elem.attr('data-sidebar-id', data.id);\r\n        _elem.attr('kit-sidebar-target', 'true');\r\n        _elem.on('click', function() {\r\n          const toggle = _sidebar.data('toggle');\r\n          switch (toggle) {\r\n            case 'on':\r\n              _sidebar.animate({\r\n                [config.direction]: '-' + config.width\r\n              });\r\n              _shade.hide();\r\n              _sidebar.data('toggle', 'off');\r\n              break;\r\n            case 'off':\r\n              _sidebar.animate({\r\n                [config.direction]: '0px'\r\n              });\r\n              _shade.show();\r\n              _sidebar.data('toggle', 'on');\r\n              break;\r\n          }\r\n        });\r\n        // 如果是elem为object 则直接触发事件\r\n        if (typeof config.elem === 'object') {\r\n          _elem.eq(0).click();\r\n        }\r\n        // 遮盖层点击关闭\r\n        config.shadeClose && _shade.on('click', function() {\r\n          _elem.eq(0).click();\r\n        });\r\n        // 绑定刷新事件\r\n        _sidebar.find('.kit-sidebar-reload').on('click', function() {\r\n          const _that = this;\r\n          if (config.dynamicRender) {\r\n            // 显示加载层\r\n            _private.showLoading(_sidebar);\r\n            const url = config.url + '?version=' + new Date().getTime();\r\n            utils.tplLoader(url, function(data) {\r\n              $(_that).parent().next('.layui-card-body').html(data);\r\n              // 关闭加载层\r\n              _private.hideLoading(_sidebar);\r\n            }, function(errMsg) {\r\n              $(_that).parent().next('.layui-card-body').html('Loading error:' + errMsg);\r\n              // 关闭加载层\r\n              _private.hideLoading(_sidebar);\r\n            })\r\n          }\r\n        });\r\n        // 绑定关闭事件\r\n        _sidebar.find('.kit-sidebar-close').on('click', function() {\r\n          _elem.eq(0).click();\r\n        });\r\n      });\r\n    },\r\n    // 显示加载层\r\n    showLoading: function(_sidebar) { //fadein\r\n      _sidebar.append(load_tpl.join(''));\r\n    },\r\n    // 移除加载层\r\n    hideLoading: function(_sidebar) {\r\n      setTimeout(function() {\r\n        const _load = _sidebar.find('.kit-sidebar-loading');\r\n        _load.addClass('layui-anim-fadeout');\r\n        setTimeout(function() {\r\n          _load.remove();\r\n        }, 300);\r\n      }, 500);\r\n    }\r\n  };\r\n  const sidebar = new Sidebar();\r\n  //输出sidebar接口\r\n  exports('sidebar', sidebar);\r\n});"]}
{"version":3,"sources":["tabs.js"],"names":["layui","define","exports","layer","tabsContent","toolsBox","onChangeBefore","undefined","tabsTitle","children","onRendered","$","_that","jquery","laytpl","utils","_","storage","route","lodash","KITADMINTABS","TABS","TAB_TITLE","TOOLSBOX","TAB_CLOSE","templates","TITLE","CONTENT","TOOLSITEM","Tabs","onChanged","join","isInit","prototype","that","extend","close","config","options","render","callback","this","target","attr","stope","parent","remove","layid","each","index","element","_private","prevHandler","on","nextHandler","toolBoxHandler","length","e","initCaches","find","off","parents","items","item","isFunction","tabCount","exists","switch","getCurrId","getByPath","path","active","getCaches","d","id","t","append","thtml","push","html","title","component","chtml","rendered","icon","_title","findTitle","hasClass","prevLayid","rIndex","prev","liWidth","tabWidth","ol","findIndex","p","c","setCaches","arguments","handle","click","offsetLeft","width","forEach","currActive","renderHTMLForContent","_content","getContent","isRendered","offsetWidth","addClass","findContent","findTools","siblings","removeClass","css","existsByPath","findTitleByPath","refresh","_container","init","left","elem","tabsLeft","tabsWidth","liCountWidth","substr","indexOf","toolHandler","PREV","TOOLS","style","parseInt","document","action","data","currId","NEXT","i","tabs","one","hide","_c","add","getItem","setItem"],"mappings":"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","file":"tabs.js","sourcesContent":["layui.define(['layer', 'laytpl', 'utils', 'lodash', 'route'], function(exports) {\r\n  var layer = layui.layer,\r\n    $ = layui.jquery,\r\n    laytpl = layui.laytpl,\r\n    utils = layui.utils,\r\n    _ = layui.lodash,\r\n    storage = utils.localStorage,\r\n    route = layui.route;\r\n\r\n\r\n  const KITADMINTABS = 'KITADMINTABS';\r\n\r\n  var TABS = '.kit-tabs',\r\n    PREV = '.kit-tabs-prev',\r\n    NEXT = '.kit-tabs-next',\r\n    TOOLS = '.kit-tabs-tools',\r\n    TAB_TITLE = '.kit-tab-title',\r\n    TAB_CLOSE = '.kit-tab-close',\r\n    TOOLSBOX = '.kit-tabs-toolsbox';\r\n\r\n  var tabsContent = undefined,\r\n    tabsTitle = undefined,\r\n    toolsBox = undefined,\r\n    templates = {\r\n      TITLE: ['<li lay-id=\"{{d.id}}\" data-path={{d.path}}>',\r\n        '<span title=\"{{d.title}}\">',\r\n        '{{#if(d.icon){}}',\r\n        '<i class=\"layui-icon\">{{d.icon}}</i> ',\r\n        '{{#}}}',\r\n        '{{d.title}}',\r\n        '</span>',\r\n        '<i class=\"layui-icon kit-tab-close\">&#x1006;</i>',\r\n        '</li>'\r\n      ].join(''),\r\n      CONTENT: ['<div class=\"kit-tabs-item\" data-path={{d.path}} lay-tab-id=\"{{d.id}}\" data-component=\"{{d.component}}\" data-rendered=\"{{d.rendered}}\">',\r\n        '<router-view></router-view>',\r\n        '</div>'\r\n      ].join(''),\r\n      TOOLSITEM: [\r\n        '<li class=\"kit-item\" lay-id=\"{{d.id}}\">',\r\n        '<a href=\"javascript:;\">',\r\n        '<span title=\"{{d.title}}\">{{d.title}}</span>&nbsp;',\r\n        '<i class=\"layui-icon layui-close\">&#x1006;</i>',\r\n        '</a>',\r\n        '</li>'\r\n      ].join('')\r\n    };\r\n\r\n  var Tabs = function() {\r\n    this.config = {\r\n      onChangeBefore: undefined,\r\n      onChanged: undefined,\r\n      onRendered: undefined\r\n    };\r\n    this.version = '1.0.2';\r\n  }\r\n  var isInit = false;\r\n  Tabs.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  Tabs.prototype.render = function(callback) {\r\n    var that = this;\r\n    var target = $(TABS).attr('kit-target');\r\n    tabsTitle = tabsTitle === undefined ? $(TAB_TITLE) : tabsTitle;\r\n    tabsContent = tabsContent === undefined ? $('div.kit-tabs-content[kit-tabs=\"' + target + '\"]') : tabsContent;\r\n    toolsBox = toolsBox === undefined ? $(TOOLSBOX).children('ul') : toolsBox;\r\n\r\n    tabsTitle.children('li').each(function(index, element) {\r\n      var _that = $(this);\r\n      var layid = _that.attr('lay-id');\r\n      _that.off('click').on('click', function() {\r\n        that.switch(layid);\r\n      });\r\n      var close = _that.find(TAB_CLOSE);\r\n      if (close.length === 1) {\r\n        close.off('click').on('click', function(e) {\r\n          layui.stope(e);\r\n          that.remove(layid);\r\n        });\r\n      }\r\n      // 绑定工具栏的移除事件\r\n      $(TOOLSBOX).find('.layui-close').off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        var parent = $(this).parents('.kit-item')\r\n        var layid = parent.attr('lay-id');\r\n        that.remove(layid);\r\n      });\r\n    });\r\n    _private.prevHandler();\r\n    _private.nextHandler();\r\n    _private.toolHandler();\r\n    _private.toolBoxHandler(that);\r\n    if (!isInit) {\r\n      isInit = true;\r\n      _private.initCaches(that);\r\n    }\r\n    utils.isFunction(callback) && callback({\r\n      tabCount: $(TAB_TITLE).children('li').length,\r\n      isIndex: _private.findTitle(_private.getCurrId()).attr('data-path') === '#/'\r\n    });\r\n    return that;\r\n  };\r\n  Tabs.prototype.add = function(options, callback) {\r\n    var that = this,\r\n      config = that.config;\r\n    if (options.active === undefined) {\r\n      // 读取缓存的tabs\r\n      var items = _private.getCaches();\r\n      var item = utils.find(items, function(d) {\r\n        return d.path === options.path;\r\n      });\r\n      // 如果在缓存中找到对应的tab信息则覆盖id\r\n      if (item !== undefined) {\r\n        options.id = item.id;\r\n      }\r\n      if (that.exists(options.id)) {\r\n        that.switch(options.id);\r\n        return;\r\n      } else if (that.existsByPath(options.path)) { //如果通过layid找不到则通过路由地址找\r\n        var t = that.getByPath(options.path);\r\n        that.switch(t.id);\r\n        return;\r\n      }\r\n    } else {\r\n      // 处理读取历史初始化的tabs\r\n      if (that.exists(options.id)) {\r\n        that.switch(options.id, true);\r\n        return;\r\n      } else if (that.existsByPath(options.path)) { //如果通过layid找不到则通过路由地址找\r\n        var t = that.getByPath(options.path);\r\n        that.switch(t.id, true);\r\n        return;\r\n      }\r\n    }\r\n    laytpl(templates.TITLE).render(options, function(html) {\r\n      // 渲染title\r\n      tabsTitle.append(html);\r\n      // 渲染主体内容\r\n      laytpl(templates.CONTENT).render(options, function(chtml) {\r\n        tabsContent.append(chtml);\r\n        //添加至右侧工具栏\r\n        laytpl(templates.TOOLSITEM).render(options, function(thtml) {\r\n          toolsBox.append(thtml);\r\n          // 处理缓存\r\n          var items = _private.getCaches();\r\n          var item = utils.find(items, function(d) {\r\n            return d.path === options.path;\r\n          });\r\n          // 如果不存在，则添加一个\r\n          if (item === undefined) {\r\n            items.push({\r\n              id: options.id,\r\n              title: options.title,\r\n              path: options.path,\r\n              component: options.component,\r\n              rendered: false,\r\n              active: true,\r\n              icon: options.icon\r\n            });\r\n          } else {\r\n            // 更新id\r\n            item.id = options.id;\r\n          }\r\n          _private.setCaches(items); //保存缓存数据\r\n          // 重新渲染\r\n          that.render();\r\n          if (options.active === undefined) {\r\n            that.switch(options.id); //获取焦点\r\n          } else {\r\n            if (options.active) that.switch(options.id, true);\r\n          }\r\n          utils.isFunction(callback) && callback();\r\n        });\r\n      });\r\n      // utils.isFunction(config.onRendered) && config.onRendered();\r\n    });\r\n  };\r\n  Tabs.prototype.remove = function(layid) {\r\n    var that = this;\r\n    var _title = _private.findTitle(layid);\r\n    // 如果是删除当前获取焦点的选项卡才销换到上一个，否则不切换\r\n    if (_title.hasClass('layui-this')) {\r\n      var prevLayid = _title.prev().attr('lay-id');\r\n      // 切换到上一个选项卡\r\n      that.switch(prevLayid);\r\n    }\r\n    // 移除\r\n    _title.remove();\r\n    _private.findContent(layid).remove();\r\n    _private.findTools(layid).remove();\r\n\r\n    var items = _private.getCaches();\r\n    var rIndex = items.findIndex(p => p.id === layid);\r\n    items.splice(rIndex, 1);\r\n    _private.setCaches(items);\r\n  };\r\n  Tabs.prototype.switch = function(layid, isInit = false) {\r\n    var that = this,\r\n      config = that.config;\r\n    var _that = _private.findTitle(layid);\r\n    if (_that.length === 0)\r\n      return;\r\n    var liWidth = _that.width() + 50;\r\n    var ol = _that[0].offsetLeft;\r\n    var tabWidth = tabsTitle.parent('div.kit-tab').width();\r\n    if (ol > tabWidth) {\r\n      var c = ol - tabWidth + liWidth;\r\n    }\r\n    var path = _that.attr('data-path');\r\n    var items = _private.getCaches();\r\n    var item = utils.find(items, function(d) {\r\n      return d.path === path;\r\n    });\r\n    // 如果是初始化，只切换到上一次选中的选项卡\r\n    if (item !== undefined && item.active && isInit) {\r\n      handle();\r\n      _that.click(); // 模拟点击当前选中的选项卡\r\n    }\r\n    // 如果是点击切换\r\n    if (!isInit) {\r\n      handle();\r\n      _.forEach(items, function(item) {\r\n        item.active = false;\r\n      });\r\n      var currActive = utils.find(items, function(d) {\r\n        return d.path === path;\r\n      });\r\n      if (currActive !== undefined) {\r\n        currActive.active = true;\r\n      }\r\n      _private.setCaches(items);\r\n      var _content = _private.getContent(layid);\r\n      // 如果该选项卡未渲染则需要执行渲染操作\r\n      if (!_content.isRendered) {\r\n        _private.renderHTMLForContent(_content.elem, _content.path);\r\n      }\r\n    }\r\n\r\n    // 触发选项卡切换事件\r\n    utils.isFunction(config.onChanged) && config.onChanged(layid);\r\n    /** \r\n     * 处理样式切换\r\n     */\r\n    function handle() {\r\n      // 切换对应的title item\r\n      _that.addClass('layui-this')\r\n        .siblings().removeClass('layui-this');\r\n\r\n      if (_that[0].offsetLeft > (_that[0].offsetWidth + _that.parents('div.kit-tab').width())) {\r\n        _that.parent('ul.kit-tab-title').css('left', -_that[0].offsetLeft - _that[0].offsetWidth + _that.parents('div.kit-tab').width())\r\n      }\r\n      // _that.parent('ul.kit-tab-title').css('left', -_that[0].offsetLeft);\r\n\r\n      // console.log(_that);\r\n      // console.log(_that[0].offsetLeft);\r\n      // console.log(_that[0].offsetWidth);\r\n      // console.log('div.kit-tab:' + _that.parents('div.kit-tab').width());\r\n      // console.log('div.kit-tabs:' + _that.parents('div.kit-tabs')[0].offsetWidth);\r\n\r\n      // 切换对应的content item\r\n      _private.findContent(layid)\r\n        .addClass('layui-show')\r\n        .siblings().removeClass('layui-show');\r\n      // 切换对应的tools item\r\n      _private.findTools(layid)\r\n        .addClass('layui-this')\r\n        .siblings().removeClass('layui-this');\r\n\r\n      var _content = _private.getContent(layid);\r\n      // 设置浏览器地址显示\r\n      utils.setUrlState(_content.path, _content.path);\r\n    }\r\n  }\r\n  Tabs.prototype.switchByPath = function(path) {\r\n    var that = this;\r\n    var _title = _private.findTitleByPath(path);\r\n    if (_title.length > 0) {\r\n      that.switch(_title.attr('lay-id'));\r\n    }\r\n  }\r\n  Tabs.prototype.exists = function(layid) {\r\n    return _private.findTitle(layid).length > 0;\r\n  }\r\n  Tabs.prototype.existsByPath = function(path) {\r\n    return _private.findTitleByPath(path).length > 0;\r\n  }\r\n  Tabs.prototype.get = function(layid) {\r\n    var that = this;\r\n    if (!that.exists(layid))\r\n      return null;\r\n    var _title = _private.findTitle(layid);\r\n    var title = _title.children('span').text();\r\n    var path = _title.attr('data-path');\r\n    var _content = _private.getContent(layid);\r\n    return {\r\n      id: layid,\r\n      title: title,\r\n      path: path,\r\n      _content: _content\r\n    };\r\n  }\r\n  Tabs.prototype.getByPath = function(path) {\r\n    var that = this;\r\n    if (!that.existsByPath(path))\r\n      return null;\r\n    var _title = _private.findTitleByPath(path);\r\n    var title = _title.children('span').text();\r\n    var layid = _title.attr('lay-id');\r\n    return {\r\n      id: layid,\r\n      title: title,\r\n      path: path\r\n    };\r\n  }\r\n  Tabs.prototype.getCurrId = function() {\r\n    return _private.getCurrId();\r\n  };\r\n  Tabs.prototype.init = function() {\r\n    var that = this;\r\n    _private.initCaches(that);\r\n    return that;\r\n  };\r\n  /**\r\n   * 刷新指定的选项卡，如果参数为空则刷新当前的选项卡\r\n   * @param {*} layid \r\n   */\r\n  Tabs.prototype.refresh = function(layid) {\r\n    layid = layid || _private.getCurrId();\r\n    var _content = _private.getContent(layid);\r\n    _private.renderHTMLForContent(_content.elem, _content.path);\r\n  };\r\n\r\n  var _private = {\r\n    renderHTMLForContent(_container, path) {\r\n      route.render(path, _container, function() {\r\n        // 将状态更新为已渲染\r\n        _container.attr('data-rendered', 'true');\r\n      });\r\n    },\r\n    prevHandler: function() {\r\n      // prev event\r\n      $(PREV).off('click').on('click', function() {\r\n        var tabsLeft = tabsTitle[0].style.left;\r\n        var left = parseInt(tabsLeft.substr(0, tabsLeft.indexOf('px')));\r\n        if (left === 0) {\r\n          return;\r\n        } else {\r\n          left += $(TABS).width();\r\n          left = left > 0 ? 0 : left;\r\n          tabsTitle.animate({\r\n            'left': left + 'px'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    nextHandler: function() {\r\n      // next event\r\n      $(NEXT).off('click').on('click', function() {\r\n        var tabsLeft = tabsTitle[0].style.left;\r\n        var left = parseInt(tabsLeft.substr(0, tabsLeft.indexOf('px')));\r\n\r\n        var tabsWidth = $(TABS).width();\r\n        var liCountWidth = -18;\r\n        tabsTitle.children('li').each(function() {\r\n          var width = $(this).width();\r\n          liCountWidth += (width + 48);\r\n        });\r\n        if (tabsWidth < liCountWidth && (left - tabsWidth) > -liCountWidth) {\r\n          left = (left - tabsWidth) >= 0 ? 0 : (left - tabsWidth);\r\n\r\n          tabsTitle.animate({\r\n            'left': left + 'px'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    toolHandler: function() {\r\n      $(TOOLS).off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        $(TOOLSBOX).show();\r\n        $(document).one('click', function() {\r\n          $(TOOLSBOX).hide();\r\n        });\r\n      });\r\n    },\r\n    toolBoxHandler: function(tabs) {\r\n      var that = this;\r\n      $(TOOLSBOX).find('li.kit-item').each(function() {\r\n        var _that = $(this);\r\n        var action = _that.data('action');\r\n        var currId = _that.attr('lay-id');\r\n        _that.off('click').on('click', function() {\r\n          var layid = that.getCurrId();\r\n          switch (action) {\r\n            case 'closeOther':\r\n              tabsTitle.find('li:not(\"[lay-id=' + layid + ']\")').each(function(i, e) {\r\n                var id = $(this).attr('lay-id');\r\n                if (i !== 0) {\r\n                  tabs.remove(id);\r\n                }\r\n              });\r\n              break;\r\n            case 'closeAll':\r\n              tabsTitle.find('li:first-child').siblings().each(function() {\r\n                var id = $(this).attr('lay-id');\r\n                tabs.remove(id);\r\n              });\r\n              break;\r\n            case 'refresh':\r\n              var _c = _private.getContent(layid);\r\n              _private.renderHTMLForContent(_c.elem, _c.path);\r\n              break;\r\n            default:\r\n              var _content = _private.getContent(currId);\r\n              if (!_content.isRendered) {\r\n                _private.renderHTMLForContent(_content.elem, _content.path);\r\n              }\r\n              tabs.switch(currId);\r\n              break;\r\n          }\r\n          $(TOOLSBOX).hide();\r\n        });\r\n      });\r\n    },\r\n    initCaches: function(_that) {\r\n      var items = this.getCaches();\r\n      _.forEach(items, function(item) {\r\n        _that.add(item);\r\n      });\r\n    },\r\n    findTitle: function(layid) {\r\n      return tabsTitle.children('li[lay-id=\"' + layid + '\"]');\r\n    },\r\n    findTitleByPath: function(path) {\r\n      return tabsTitle.children('li[data-path=\"' + path + '\"]');\r\n    },\r\n    findContent: function(layid) {\r\n      return tabsContent.children('div.kit-tabs-item[lay-tab-id=\"' + layid + '\"]');\r\n    },\r\n    getContent: function(layid) {\r\n      var _content = this.findContent(layid);\r\n      return {\r\n        elem: _content,\r\n        component: _content.attr('data-component'),\r\n        path: _content.attr('data-path'),\r\n        isRendered: _content.attr('data-rendered') === 'true',\r\n      };\r\n    },\r\n    findTools: function(layid) {\r\n      return toolsBox.find('li.kit-item[lay-id=\"' + layid + '\"]');\r\n    },\r\n    getCurrId: function() {\r\n      return tabsTitle.find('li.layui-this').attr('lay-id');\r\n    },\r\n    getCaches: function() {\r\n      var items = storage.getItem(KITADMINTABS);\r\n      if (items === null) {\r\n        items = [];\r\n      }\r\n      return items;\r\n    },\r\n    setCaches: function(data) {\r\n      storage.setItem(KITADMINTABS, data)\r\n    }\r\n  }\r\n\r\n  var tabs = new Tabs();\r\n\r\n  //输出tabs接口\r\n  exports('tabs', tabs);\r\n});"]}